<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mondal Mobile-POS</title>
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #f8f9fa;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --dark-color: #343a40;
            --light-color: #f8f9fa;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 250px;
            background-color: var(--dark-color);
            color: white;
            padding: 20px 0;
            transition: all 0.3s;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h3 {
            color: white;
            text-align: center;
        }

        .sidebar-menu {
            padding: 20px 0;
        }

        .menu-item {
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s;
        }

        .menu-item:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .menu-item.active {
            background-color: var(--primary-color);
        }

        .menu-item i {
            margin-right: 10px;
            font-size: 18px;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .header h2 {
            color: var(--dark-color);
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            transition: transform 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 16px;
            color: #666;
        }

        .card-icon {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .card-icon.sales {
            background-color: var(--primary-color);
        }

        .card-icon.profit {
            background-color: var(--success-color);
        }

        .card-icon.monthly {
            background-color: var(--info-color);
        }

        .card-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-color);
        }

        /* Tables */
        .table-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f8f9fa;
            font-weight: 600;
            color: #333;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .action-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 5px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .edit-btn {
            background-color: var(--warning-color);
            color: black;
        }

        .delete-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .print-btn {
            background-color: var(--info-color);
            color: white;
        }

        /* Forms */
        .form-container {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3a5bd9;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #218838;
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        /* New Bill Section */
        .bill-container {
            display: flex;
            gap: 20px;
        }

        .bill-products {
            flex: 1;
        }

        .bill-summary {
            width: 350px;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: sticky;
            top: 20px;
        }

        .bill-summary h3 {
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #ddd;
        }

        .bill-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .bill-total {
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
        }

        .product-search {
            position: relative;
            margin-bottom: 20px;
        }

        .product-search input {
            padding-right: 40px;
        }

        .search-icon {
            position: absolute;
            right: 10px;
            top: 10px;
            color: #666;
        }

        .selected-products {
            margin-top: 20px;
        }

        .selected-product {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .product-quantity {
            display: flex;
            align-items: center;
        }

        .quantity-btn {
            width: 30px;
            height: 30px;
            border: 1px solid #ddd;
            background-color: #f8f9fa;
            cursor: pointer;
            font-size: 16px;
        }

        .quantity-input {
            width: 50px;
            height: 30px;
            text-align: center;
            border: 1px solid #ddd;
            margin: 0 5px;
        }

        .remove-product {
            color: var(--danger-color);
            cursor: pointer;
            margin-left: 10px;
        }

        /* Print Template */
        @media print {
            body * {
                visibility: hidden;
            }
            .print-section, .print-section * {
                visibility: visible;
            }
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }

        .print-section {
            display: none;
            background-color: white;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        .print-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .print-header h2 {
            color: var(--dark-color);
            margin-bottom: 5px;
        }

        .print-details {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .print-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }

        .print-table th, .print-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .print-table th {
            background-color: #f5f5f5;
        }

        .print-total {
            text-align: right;
            margin-top: 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .print-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 10px;
            border-top: 1px solid #ddd;
            font-size: 14px;
            color: #666;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
            }
            .bill-container {
                flex-direction: column;
            }
            .bill-summary {
                width: 100%;
                position: static;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <h3>Mondal Mobile-POS</h3>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt"></i>
                    <span>Dashboard</span>
                </div>
                <div class="menu-item" data-section="products">
                    <i class="fas fa-box"></i>
                    <span>Products</span>
                </div>
                <div class="menu-item" data-section="new-bill">
                    <i class="fas fa-receipt"></i>
                    <span>New Bill</span>
                </div>
                <div class="menu-item" data-section="saved-bills">
                    <i class="fas fa-save"></i>
                    <span>Saved Bills</span>
                </div>
                <div class="menu-item" data-section="sales">
                    <i class="fas fa-chart-line"></i>
                    <span>Sales</span>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Dashboard Section -->
            <div id="dashboard" class="content-section">
                <div class="header">
                    <h2>Dashboard</h2>
                    <div id="current-date"></div>
                </div>
                
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Today's Sales</div>
                            <div class="card-icon sales">
                                <i class="fas fa-rupee-sign"></i>
                            </div>
                        </div>
                        <div class="card-value" id="today-sales">₹0</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Today's Profit</div>
                            <div class="card-icon profit">
                                <i class="fas fa-chart-pie"></i>
                            </div>
                        </div>
                        <div class="card-value" id="today-profit">₹0</div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Monthly Sales</div>
                            <div class="card-icon monthly">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                        </div>
                        <div class="card-value" id="monthly-sales">₹0</div>
                    </div>
                </div>
                
                <div class="table-container">
                    <h3>Recent Sales</h3>
                    <table id="recent-sales-table">
                        <thead>
                            <tr>
                                <th>Invoice No.</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Recent sales will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Products Section -->
            <div id="products" class="content-section" style="display: none;">
                <div class="header">
                    <h2>Products</h2>
                    <button class="btn btn-primary" id="add-product-btn">Add Product</button>
                </div>
                
                <div class="form-container" id="product-form-container" style="display: none;">
                    <h3 id="product-form-title">Add New Product</h3>
                    <form id="product-form">
                        <input type="hidden" id="product-id">
                        <div class="form-group">
                            <label for="product-name">Product Name</label>
                            <input type="text" class="form-control" id="product-name" required>
                        </div>
                        <div class="form-group">
                            <label for="purchase-price">Purchase Price (₹)</label>
                            <input type="number" class="form-control" id="purchase-price" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="sell-price">Sell Price (₹)</label>
                            <input type="number" class="form-control" id="sell-price" min="0" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="quantity">Quantity</label>
                            <input type="number" class="form-control" id="quantity" min="0" required>
                        </div>
                        <div class="form-group">
                            <label for="description">Description (Optional)</label>
                            <textarea class="form-control" id="description" rows="2"></textarea>
                        </div>
                        <button type="submit" class="btn btn-primary">Save Product</button>
                        <button type="button" class="btn btn-danger" id="cancel-product-btn">Cancel</button>
                    </form>
                </div>
                
                <div class="table-container">
                    <div class="product-search">
                        <input type="text" class="form-control" id="product-search" placeholder="Search products...">
                        <i class="fas fa-search search-icon"></i>
                    </div>
                    <table id="products-table">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Purchase Price</th>
                                <th>Sell Price</th>
                                <th>Quantity</th>
                                <th>Profit per Unit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Products will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- New Bill Section -->
            <div id="new-bill" class="content-section" style="display: none;">
                <div class="header">
                    <h2>New Bill</h2>
                </div>
                
                <div class="bill-container">
                    <div class="bill-products">
                        <div class="form-container">
                            <div class="form-group">
                                <label for="customer-name">Customer Name</label>
                                <input type="text" class="form-control" id="customer-name" placeholder="Optional">
                            </div>
                            <div class="form-group">
                                <label for="customer-phone">Customer Phone</label>
                                <input type="text" class="form-control" id="customer-phone" placeholder="Optional">
                            </div>
                        </div>
                        
                        <div class="form-container">
                            <div class="product-search">
                                <input type="text" class="form-control" id="bill-product-search" placeholder="Search products to add...">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <div id="product-search-results" style="display: none;">
                                <!-- Search results will appear here -->
                            </div>
                        </div>
                        
                        <div class="form-container selected-products">
                            <h3>Selected Products</h3>
                            <div id="selected-products-list">
                                <!-- Selected products will appear here -->
                                <p class="no-products-message">No products added yet.</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bill-summary">
                        <h3>Bill Summary</h3>
                        <div class="bill-item">
                            <span>Subtotal:</span>
                            <span id="subtotal-amount">₹0</span>
                        </div>
                        <div class="bill-item">
                            <span>Discount:</span>
                            <div>
                                <input type="number" id="discount-input" min="0" value="0" style="width: 80px; padding: 5px;"> ₹
                            </div>
                        </div>
                        <div class="bill-item bill-total">
                            <span>Grand Total:</span>
                            <span id="grand-total">₹0</span>
                        </div>
                        
                        <div class="form-group" style="margin-top: 20px;">
                            <button class="btn btn-success" id="print-bill-btn" style="width: 100%; margin-bottom: 10px;">
                                <i class="fas fa-print"></i> Print Bill
                            </button>
                            <button class="btn btn-primary" id="save-bill-btn" style="width: 100%; margin-bottom: 10px;">
                                <i class="fas fa-save"></i> Save Bill
                            </button>
                            <button class="btn btn-danger" id="cancel-bill-btn" style="width: 100%;">
                                <i class="fas fa-times"></i> Cancel
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Saved Bills Section -->
            <div id="saved-bills" class="content-section" style="display: none;">
                <div class="header">
                    <h2>Saved Bills</h2>
                </div>
                
                <div class="table-container">
                    <table id="saved-bills-table">
                        <thead>
                            <tr>
                                <th>Invoice No.</th>
                                <th>Date</th>
                                <th>Customer</th>
                                <th>Amount</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Saved bills will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Sales Section -->
            <div id="sales" class="content-section" style="display: none;">
                <div class="header">
                    <h2>Sales Report</h2>
                    <div>
                        <input type="date" id="sales-date-filter" class="form-control" style="display: inline-block; width: auto;">
                    </div>
                </div>
                
                <div class="table-container">
                    <table id="sales-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Invoice No.</th>
                                <th>Customer</th>
                                <th>Products</th>
                                <th>Sale Amount</th>
                                <th>Purchase Cost</th>
                                <th>Profit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Sales data will be populated here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Print Template (Hidden until needed) -->
    <div id="print-template" class="print-section">
        <div class="print-header">
            <h2>Mondal Mobile Accessories</h2>
            <p>Phone: 7001902533</p>
        </div>
        
        <div class="print-details">
            <div>
                <p><strong>Invoice No:</strong> <span id="print-invoice-no">INV-001</span></p>
                <p><strong>Date:</strong> <span id="print-date">01 Jan 2023</span></p>
            </div>
            <div>
                <p><strong>Customer:</strong> <span id="print-customer">Walk-in Customer</span></p>
                <p><strong>Phone:</strong> <span id="print-customer-phone">N/A</span></p>
            </div>
        </div>
        
        <table class="print-table">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Price</th>
                    <th>Qty</th>
                    <th>Total</th>
                </tr>
            </thead>
            <tbody id="print-products-list">
                <!-- Products will be added here -->
            </tbody>
        </table>
        
        <div class="print-total">
            <p>Subtotal: <span id="print-subtotal">₹0</span></p>
            <p>Discount: <span id="print-discount">₹0</span></p>
            <p><strong>Grand Total: <span id="print-grand-total">₹0</span></strong></p>
        </div>
        
        <div class="print-footer">
            <p>Thank you for your purchase!</p>
            <p>Please bring this invoice for any returns or exchanges within 7 days.</p>
        </div>
    </div>

    <script>
        // DOM Elements
        const menuItems = document.querySelectorAll('.menu-item');
        const contentSections = document.querySelectorAll('.content-section');
        const currentDateElement = document.getElementById('current-date');
        
        // Dashboard Elements
        const todaySalesElement = document.getElementById('today-sales');
        const todayProfitElement = document.getElementById('today-profit');
        const monthlySalesElement = document.getElementById('monthly-sales');
        const recentSalesTable = document.getElementById('recent-sales-table').querySelector('tbody');
        
        // Product Elements
        const addProductBtn = document.getElementById('add-product-btn');
        const productFormContainer = document.getElementById('product-form-container');
        const productForm = document.getElementById('product-form');
        const productFormTitle = document.getElementById('product-form-title');
        const cancelProductBtn = document.getElementById('cancel-product-btn');
        const productsTable = document.getElementById('products-table').querySelector('tbody');
        const productSearch = document.getElementById('product-search');
        
        // New Bill Elements
        const billProductSearch = document.getElementById('bill-product-search');
        const productSearchResults = document.getElementById('product-search-results');
        const selectedProductsList = document.getElementById('selected-products-list');
        const subtotalAmountElement = document.getElementById('subtotal-amount');
        const discountInput = document.getElementById('discount-input');
        const grandTotalElement = document.getElementById('grand-total');
        const customerNameInput = document.getElementById('customer-name');
        const customerPhoneInput = document.getElementById('customer-phone');
        const printBillBtn = document.getElementById('print-bill-btn');
        const saveBillBtn = document.getElementById('save-bill-btn');
        const cancelBillBtn = document.getElementById('cancel-bill-btn');
        
        // Saved Bills Elements
        const savedBillsTable = document.getElementById('saved-bills-table').querySelector('tbody');
        
        // Sales Elements
        const salesTable = document.getElementById('sales-table').querySelector('tbody');
        const salesDateFilter = document.getElementById('sales-date-filter');
        
        // Print Template Elements
        const printTemplate = document.getElementById('print-template');
        const printInvoiceNo = document.getElementById('print-invoice-no');
        const printDate = document.getElementById('print-date');
        const printCustomer = document.getElementById('print-customer');
        const printCustomerPhone = document.getElementById('print-customer-phone');
        const printProductsList = document.getElementById('print-products-list');
        const printSubtotal = document.getElementById('print-subtotal');
        const printDiscount = document.getElementById('print-discount');
        const printGrandTotal = document.getElementById('print-grand-total');
        
        // Data Storage
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let bills = JSON.parse(localStorage.getItem('bills')) || [];
        let sales = JSON.parse(localStorage.getItem('sales')) || [];
        
        // Current Bill
        let currentBill = {
            products: [],
            subtotal: 0,
            discount: 0,
            grandTotal: 0,
            customerName: '',
            customerPhone: ''
        };
        
        // Initialize the app
        function init() {
            // Set current date
            const now = new Date();
            currentDateElement.textContent = now.toLocaleDateString('en-IN', { 
                weekday: 'long', 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
            
            // Set default date filter to today
            salesDateFilter.valueAsDate = now;
            
            // Load data
            updateDashboard();
            renderProductsTable();
            renderSavedBillsTable();
            renderSalesTable();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Menu navigation
            menuItems.forEach(item => {
                item.addEventListener('click', () => {
                    const section = item.getAttribute('data-section');
                    showSection(section);
                    
                    // Update active menu item
                    menuItems.forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                });
            });
            
            // Product form
            addProductBtn.addEventListener('click', () => {
                productForm.reset();
                document.getElementById('product-id').value = '';
                productFormTitle.textContent = 'Add New Product';
                productFormContainer.style.display = 'block';
            });
            
            cancelProductBtn.addEventListener('click', () => {
                productFormContainer.style.display = 'none';
            });
            
            productForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveProduct();
            });
            
            // Product search
            productSearch.addEventListener('input', () => {
                filterProducts();
            });
            
            // Bill product search
            billProductSearch.addEventListener('input', () => {
                searchProductsForBill();
            });
            
            // Discount input
            discountInput.addEventListener('change', () => {
                updateBillSummary();
            });
            
            // Bill buttons
            printBillBtn.addEventListener('click', () => {
                printBill();
            });
            
            saveBillBtn.addEventListener('click', () => {
                saveBill();
            });
            
            cancelBillBtn.addEventListener('click', () => {
                resetBill();
            });
            
            // Sales date filter
            salesDateFilter.addEventListener('change', () => {
                renderSalesTable();
            });
        }
        
        // Show a specific section
        function showSection(sectionId) {
            contentSections.forEach(section => {
                section.style.display = 'none';
            });
            
            document.getElementById(sectionId).style.display = 'block';
            
            // Refresh data if needed
            if (sectionId === 'dashboard') {
                updateDashboard();
            } else if (sectionId === 'products') {
                renderProductsTable();
            } else if (sectionId === 'saved-bills') {
                renderSavedBillsTable();
            } else if (sectionId === 'sales') {
                renderSalesTable();
            } else if (sectionId === 'new-bill') {
                resetBill();
            }
        }
        
        // Dashboard functions
        function updateDashboard() {
            const today = new Date().toISOString().split('T')[0];
            const currentMonth = new Date().getMonth() + 1;
            const currentYear = new Date().getFullYear();
            
            // Filter today's sales
            const todaySales = sales.filter(sale => {
                const saleDate = new Date(sale.date).toISOString().split('T')[0];
                return saleDate === today;
            });
            
            // Calculate today's totals
            const todaySalesTotal = todaySales.reduce((total, sale) => total + sale.amount, 0);
            const todayProfitTotal = todaySales.reduce((total, sale) => total + sale.profit, 0);
            
            // Filter monthly sales
            const monthlySales = sales.filter(sale => {
                const saleDate = new Date(sale.date);
                return saleDate.getMonth() + 1 === currentMonth && saleDate.getFullYear() === currentYear;
            });
            
            // Calculate monthly total
            const monthlySalesTotal = monthlySales.reduce((total, sale) => total + sale.amount, 0);
            
            // Update dashboard
            todaySalesElement.textContent = `₹${todaySalesTotal.toFixed(2)}`;
            todayProfitElement.textContent = `₹${todayProfitTotal.toFixed(2)}`;
            monthlySalesElement.textContent = `₹${monthlySalesTotal.toFixed(2)}`;
            
            // Update recent sales table
            renderRecentSalesTable();
        }
        
        function renderRecentSalesTable() {
            recentSalesTable.innerHTML = '';
            
            // Get last 5 sales
            const recentSales = [...sales].reverse().slice(0, 5);
            
            recentSales.forEach(sale => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${sale.invoiceNo}</td>
                    <td>${formatDate(sale.date)}</td>
                    <td>${sale.customerName || 'Walk-in'}</td>
                    <td>₹${sale.amount.toFixed(2)}</td>
                    <td>₹${sale.profit.toFixed(2)}</td>
                `;
                
                recentSalesTable.appendChild(row);
            });
        }
        
        // Product functions
        function saveProduct() {
            const productId = document.getElementById('product-id').value;
            const productName = document.getElementById('product-name').value;
            const purchasePrice = parseFloat(document.getElementById('purchase-price').value);
            const sellPrice = parseFloat(document.getElementById('sell-price').value);
            const quantity = parseInt(document.getElementById('quantity').value);
            const description = document.getElementById('description').value;
            
            if (productId) {
                // Update existing product
                const index = products.findIndex(p => p.id === productId);
                if (index !== -1) {
                    products[index] = {
                        ...products[index],
                        name: productName,
                        purchasePrice,
                        sellPrice,
                        quantity,
                        description
                    };
                }
            } else {
                // Add new product
                const newProduct = {
                    id: generateId(),
                    name: productName,
                    purchasePrice,
                    sellPrice,
                    quantity,
                    description,
                    createdAt: new Date().toISOString()
                };
                
                products.push(newProduct);
            }
            
            // Save to localStorage
            localStorage.setItem('products', JSON.stringify(products));
            
            // Reset form and update table
            productForm.reset();
            productFormContainer.style.display = 'none';
            renderProductsTable();
        }
        
        function renderProductsTable() {
            productsTable.innerHTML = '';
            
            if (products.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" style="text-align: center;">No products found. Add your first product!</td>`;
                productsTable.appendChild(row);
                return;
            }
            
            products.forEach(product => {
                const profitPerUnit = product.sellPrice - product.purchasePrice;
                
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>₹${product.purchasePrice.toFixed(2)}</td>
                    <td>₹${product.sellPrice.toFixed(2)}</td>
                    <td>${product.quantity}</td>
                    <td>₹${profitPerUnit.toFixed(2)}</td>
                    <td>
                        <button class="action-btn edit-btn" data-id="${product.id}">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="action-btn delete-btn" data-id="${product.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                
                productsTable.appendChild(row);
            });
            
            // Add event listeners to edit and delete buttons
            document.querySelectorAll('.edit-btn').forEach(btn => {
                btn.addEventListener('click', () => editProduct(btn.getAttribute('data-id')));
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteProduct(btn.getAttribute('data-id')));
            });
        }
        
        function editProduct(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;
            
            document.getElementById('product-id').value = product.id;
            document.getElementById('product-name').value = product.name;
            document.getElementById('purchase-price').value = product.purchasePrice;
            document.getElementById('sell-price').value = product.sellPrice;
            document.getElementById('quantity').value = product.quantity;
            document.getElementById('description').value = product.description || '';
            
            productFormTitle.textContent = 'Edit Product';
            productFormContainer.style.display = 'block';
        }
        
        function deleteProduct(productId) {
            if (confirm('Are you sure you want to delete this product?')) {
                products = products.filter(p => p.id !== productId);
                localStorage.setItem('products', JSON.stringify(products));
                renderProductsTable();
            }
        }
        
        function filterProducts() {
            const searchTerm = productSearch.value.toLowerCase();
            
            productsTable.querySelectorAll('tr').forEach(row => {
                const productName = row.querySelector('td:first-child').textContent.toLowerCase();
                row.style.display = productName.includes(searchTerm) ? '' : 'none';
            });
        }
        
        // Bill functions
        function searchProductsForBill() {
            const searchTerm = billProductSearch.value.toLowerCase();
            
            if (searchTerm.length < 1) {
                productSearchResults.style.display = 'none';
                return;
            }
            
            const matchingProducts = products.filter(product => 
                product.name.toLowerCase().includes(searchTerm) && product.quantity > 0
            );
            
            if (matchingProducts.length === 0) {
                productSearchResults.innerHTML = '<div class="no-results">No products found</div>';
                productSearchResults.style.display = 'block';
                return;
            }
            
            productSearchResults.innerHTML = '';
            
            matchingProducts.forEach(product => {
                const productElement = document.createElement('div');
                productElement.className = 'search-result-item';
                productElement.innerHTML = `
                    <div>${product.name}</div>
                    <div>₹${product.sellPrice.toFixed(2)} (${product.quantity} available)</div>
                `;
                
                productElement.addEventListener('click', () => {
                    addProductToBill(product);
                    billProductSearch.value = '';
                    productSearchResults.style.display = 'none';
                });
                
                productSearchResults.appendChild(productElement);
            });
            
            productSearchResults.style.display = 'block';
        }
        
        function addProductToBill(product) {
            // Check if product already exists in bill
            const existingProduct = currentBill.products.find(p => p.id === product.id);
            
            if (existingProduct) {
                // Increase quantity if not exceeding available stock
                if (existingProduct.quantity < product.quantity) {
                    existingProduct.quantity++;
                } else {
                    alert(`Only ${product.quantity} units available in stock.`);
                    return;
                }
            } else {
                // Add new product to bill with quantity 1
                currentBill.products.push({
                    id: product.id,
                    name: product.name,
                    sellPrice: product.sellPrice,
                    purchasePrice: product.purchasePrice,
                    quantity: 1
                });
            }
            
            renderSelectedProducts();
            updateBillSummary();
        }
        
        function renderSelectedProducts() {
            if (currentBill.products.length === 0) {
                selectedProductsList.innerHTML = '<p class="no-products-message">No products added yet.</p>';
                return;
            }
            
            selectedProductsList.innerHTML = '';
            
            currentBill.products.forEach((product, index) => {
                const productElement = document.createElement('div');
                productElement.className = 'selected-product';
                
                const productInStock = products.find(p => p.id === product.id);
                const maxQuantity = productInStock ? productInStock.quantity : 0;
                
                productElement.innerHTML = `
                    <div class="product-info">
                        <div class="product-name">${product.name}</div>
                        <div class="product-price">₹${product.sellPrice.toFixed(2)}</div>
                    </div>
                    <div class="product-quantity">
                        <button class="quantity-btn decrease" data-index="${index}">-</button>
                        <input type="number" class="quantity-input" value="${product.quantity}" min="1" max="${maxQuantity}" data-index="${index}">
                        <button class="quantity-btn increase" data-index="${index}">+</button>
                        <span class="product-total">₹${(product.sellPrice * product.quantity).toFixed(2)}</span>
                        <span class="remove-product" data-index="${index}"><i class="fas fa-times"></i></span>
                    </div>
                `;
                
                selectedProductsList.appendChild(productElement);
            });
            
            // Add event listeners to quantity controls
            document.querySelectorAll('.quantity-btn.decrease').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    decreaseQuantity(index);
                });
            });
            
            document.querySelectorAll('.quantity-btn.increase').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    increaseQuantity(index);
                });
            });
            
            document.querySelectorAll('.quantity-input').forEach(input => {
                input.addEventListener('change', (e) => {
                    const index = e.target.getAttribute('data-index');
                    const newQuantity = parseInt(e.target.value);
                    updateQuantity(index, newQuantity);
                });
            });
            
            document.querySelectorAll('.remove-product').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.closest('.remove-product').getAttribute('data-index');
                    removeProduct(index);
                });
            });
        }
        
        function decreaseQuantity(index) {
            if (currentBill.products[index].quantity > 1) {
                currentBill.products[index].quantity--;
                renderSelectedProducts();
                updateBillSummary();
            }
        }
        
        function increaseQuantity(index) {
            const productId = currentBill.products[index].id;
            const productInStock = products.find(p => p.id === productId);
            
            if (currentBill.products[index].quantity < productInStock.quantity) {
                currentBill.products[index].quantity++;
                renderSelectedProducts();
                updateBillSummary();
            } else {
                alert(`Only ${productInStock.quantity} units available in stock.`);
            }
        }
        
        function updateQuantity(index, newQuantity) {
            const productId = currentBill.products[index].id;
            const productInStock = products.find(p => p.id === productId);
            
            if (newQuantity < 1) {
                newQuantity = 1;
            } else if (newQuantity > productInStock.quantity) {
                newQuantity = productInStock.quantity;
                alert(`Only ${productInStock.quantity} units available in stock.`);
            }
            
            currentBill.products[index].quantity = newQuantity;
            renderSelectedProducts();
            updateBillSummary();
        }
        
        function removeProduct(index) {
            currentBill.products.splice(index, 1);
            renderSelectedProducts();
            updateBillSummary();
        }
        
        function updateBillSummary() {
            currentBill.customerName = customerNameInput.value;
            currentBill.customerPhone = customerPhoneInput.value;
            currentBill.discount = parseFloat(discountInput.value) || 0;
            
            // Calculate subtotal
            currentBill.subtotal = currentBill.products.reduce((total, product) => {
                return total + (product.sellPrice * product.quantity);
            }, 0);
            
            // Calculate grand total
            currentBill.grandTotal = currentBill.subtotal - currentBill.discount;
            if (currentBill.grandTotal < 0) currentBill.grandTotal = 0;
            
            // Update UI
            subtotalAmountElement.textContent = `₹${currentBill.subtotal.toFixed(2)}`;
            grandTotalElement.textContent = `₹${currentBill.grandTotal.toFixed(2)}`;
        }
        
        function resetBill() {
            currentBill = {
                products: [],
                subtotal: 0,
                discount: 0,
                grandTotal: 0,
                customerName: '',
                customerPhone: ''
            };
            
            customerNameInput.value = '';
            customerPhoneInput.value = '';
            discountInput.value = '0';
            
            renderSelectedProducts();
            updateBillSummary();
        }
        
        function saveBill() {
            if (currentBill.products.length === 0) {
                alert('Please add at least one product to the bill.');
                return;
            }
            
            // Generate invoice number
            const invoiceNo = `INV-${new Date().getTime().toString().slice(-6)}`;
            
            // Calculate profit (considering discount)
            const totalPurchaseCost = currentBill.products.reduce((total, product) => {
                return total + (product.purchasePrice * product.quantity);
            }, 0);
            
            const profit = (currentBill.subtotal - currentBill.discount) - totalPurchaseCost;
            
            // Create bill object
            const bill = {
                id: generateId(),
                invoiceNo,
                date: new Date().toISOString(),
                customerName: currentBill.customerName,
                customerPhone: currentBill.customerPhone,
                products: [...currentBill.products],
                subtotal: currentBill.subtotal,
                discount: currentBill.discount,
                amount: currentBill.grandTotal,
                profit: profit
            };
            
            // Add to bills and sales
            bills.push(bill);
            sales.push({
                ...bill,
                purchaseCost: totalPurchaseCost
            });
            
            // Update product quantities
            currentBill.products.forEach(billProduct => {
                const product = products.find(p => p.id === billProduct.id);
                if (product) {
                    product.quantity -= billProduct.quantity;
                    if (product.quantity < 0) product.quantity = 0;
                }
            });
            
            // Save to localStorage
            localStorage.setItem('bills', JSON.stringify(bills));
            localStorage.setItem('sales', JSON.stringify(sales));
            localStorage.setItem('products', JSON.stringify(products));
            
            // Reset and update UI
            resetBill();
            updateDashboard();
            renderProductsTable();
            
            alert('Bill saved successfully!');
        }
        
        function printBill() {
            if (currentBill.products.length === 0) {
                alert('Please add at least one product to the bill.');
                return;
            }
            
            // Generate invoice number for print
            const invoiceNo = `INV-${new Date().getTime().toString().slice(-6)}`;
            
            // Update print template
            printInvoiceNo.textContent = invoiceNo;
            printDate.textContent = formatDate(new Date());
            printCustomer.textContent = currentBill.customerName || 'Walk-in Customer';
            printCustomerPhone.textContent = currentBill.customerPhone || 'N/A';
            
            // Clear and populate products list
            printProductsList.innerHTML = '';
            currentBill.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>₹${product.sellPrice.toFixed(2)}</td>
                    <td>${product.quantity}</td>
                    <td>₹${(product.sellPrice * product.quantity).toFixed(2)}</td>
                `;
                printProductsList.appendChild(row);
            });
            
            // Update totals
            printSubtotal.textContent = `₹${currentBill.subtotal.toFixed(2)}`;
            printDiscount.textContent = `₹${currentBill.discount.toFixed(2)}`;
            printGrandTotal.textContent = `₹${currentBill.grandTotal.toFixed(2)}`;
            
            // Show print template and print
            printTemplate.style.display = 'block';
            window.print();
            printTemplate.style.display = 'none';
        }
        
        // Saved Bills functions
        function renderSavedBillsTable() {
            savedBillsTable.innerHTML = '';
            
            // Filter bills from last 30 days
            const thirtyDaysAgo = new Date();
            thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
            
            const recentBills = bills.filter(bill => {
                return new Date(bill.date) >= thirtyDaysAgo;
            });
            
            if (recentBills.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="5" style="text-align: center;">No bills found from the last 30 days.</td>`;
                savedBillsTable.appendChild(row);
                return;
            }
            
            recentBills.forEach(bill => {
                const row = document.createElement('tr');
                
                row.innerHTML = `
                    <td>${bill.invoiceNo}</td>
                    <td>${formatDate(bill.date)}</td>
                    <td>${bill.customerName || 'Walk-in'}</td>
                    <td>₹${bill.amount.toFixed(2)}</td>
                    <td>
                        <button class="action-btn print-btn" data-id="${bill.id}">
                            <i class="fas fa-print"></i> Print
                        </button>
                        <button class="action-btn delete-btn" data-id="${bill.id}">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </td>
                `;
                
                savedBillsTable.appendChild(row);
            });
            
            // Add event listeners to buttons
            document.querySelectorAll('.print-btn').forEach(btn => {
                btn.addEventListener('click', () => printSavedBill(btn.getAttribute('data-id')));
            });
            
            document.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', () => deleteSavedBill(btn.getAttribute('data-id')));
            });
        }
        
        function printSavedBill(billId) {
            const bill = bills.find(b => b.id === billId);
            if (!bill) return;
            
            // Update print template
            printInvoiceNo.textContent = bill.invoiceNo;
            printDate.textContent = formatDate(bill.date);
            printCustomer.textContent = bill.customerName || 'Walk-in Customer';
            printCustomerPhone.textContent = bill.customerPhone || 'N/A';
            
            // Clear and populate products list
            printProductsList.innerHTML = '';
            bill.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.name}</td>
                    <td>₹${product.sellPrice.toFixed(2)}</td>
                    <td>${product.quantity}</td>
                    <td>₹${(product.sellPrice * product.quantity).toFixed(2)}</td>
                `;
                printProductsList.appendChild(row);
            });
            
            // Update totals
            printSubtotal.textContent = `₹${bill.subtotal.toFixed(2)}`;
            printDiscount.textContent = `₹${bill.discount.toFixed(2)}`;
            printGrandTotal.textContent = `₹${bill.amount.toFixed(2)}`;
            
            // Show print template and print
            printTemplate.style.display = 'block';
            window.print();
            printTemplate.style.display = 'none';
        }
        
        function deleteSavedBill(billId) {
            if (confirm('Are you sure you want to delete this bill? This action cannot be undone.')) {
                bills = bills.filter(b => b.id !== billId);
                sales = sales.filter(s => s.id !== billId);
                
                localStorage.setItem('bills', JSON.stringify(bills));
                localStorage.setItem('sales', JSON.stringify(sales));
                
                renderSavedBillsTable();
                updateDashboard();
            }
        }
        
        // Sales functions
        function renderSalesTable() {
            salesTable.innerHTML = '';
            
            const filterDate = salesDateFilter.value;
            let filteredSales = [...sales];
            
            if (filterDate) {
                filteredSales = filteredSales.filter(sale => {
                    const saleDate = new Date(sale.date).toISOString().split('T')[0];
                    return saleDate === filterDate;
                });
            }
            
            if (filteredSales.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" style="text-align: center;">No sales found for the selected date.</td>`;
                salesTable.appendChild(row);
                return;
            }
            
            filteredSales.forEach(sale => {
                const row = document.createElement('tr');
                
                // Get product names (first 2 with count if more)
                let productNames = sale.products.map(p => p.name);
                let productsDisplay = productNames.slice(0, 2).join(', ');
                if (productNames.length > 2) {
                    productsDisplay += ` (+${productNames.length - 2} more)`;
                }
                
                row.innerHTML = `
                    <td>${formatDate(sale.date)}</td>
                    <td>${sale.invoiceNo}</td>
                    <td>${sale.customerName || 'Walk-in'}</td>
                    <td>${productsDisplay}</td>
                    <td>₹${sale.amount.toFixed(2)}</td>
                    <td>₹${sale.products.reduce((total, p) => total + (p.purchasePrice * p.quantity), 0).toFixed(2)}</td>
                    <td>₹${sale.profit.toFixed(2)}</td>
                `;
                
                salesTable.appendChild(row);
            });
        }
        
        // Helper functions
        function generateId() {
            return Math.random().toString(36).substr(2, 9);
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-IN', {
                day: '2-digit',
                month: 'short',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        // Initialize the app
        init();
    </script>
</body>
</html>